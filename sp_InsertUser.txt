CREATE PROCEDURE dbo.sp_InsertUser
(
    @Name NVARCHAR(100),
    @Surname NVARCHAR(100),
    @Username NVARCHAR(50),
    @Password NVARCHAR(100)
)
AS
BEGIN
    SET NOCOUNT ON;

    IF EXISTS (SELECT 1 FROM [dbo].[Users] WHERE Username = @Username)
    BEGIN
        RAISERROR('Username already exists.', 16, 1);
        RETURN;
    END

    DECLARE @Salt NVARCHAR(50) = CAST(NEWID() AS NVARCHAR(50));

    DECLARE @Hash VARBINARY(64) = HASHBYTES('SHA2_512', @Password + @Salt);

    DECLARE @HashString NVARCHAR(128) = CONVERT(NVARCHAR(128), @Hash, 2);

    INSERT INTO [dbo].[Users] ([Name], Surname, Username, HashPassword, SaltPassword)
    VALUES
    (
        @Name,
        @Surname,
        @Username,
        @HashString,
        @Salt
    )

END
